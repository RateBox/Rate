const { test, expect } = require('@playwright/test');\n\ntest('Fix bug Seller với plugin v1.0.6 - Test cuối cùng', async ({ page }) => {\n  test.setTimeout(120000); // 2 phút timeout\n  \n  console.log('🔍 Bắt đầu fix bug Seller với plugin v1.0.6...');\n  \n  // Đăng nhập vào Strapi admin\n  await page.goto('http://localhost:1337/admin/auth/login');\n  await page.waitForLoadState('networkidle');\n  \n  await page.fill('input[name=\"email\"]', 'admin@ratebox.vn');\n  await page.fill('input[name=\"password\"]', 'Abc@123456');\n  await page.click('button[type=\"submit\"]');\n  \n  try {\n    await page.waitForURL('**/admin', { timeout: 30000 });\n  } catch (error) {\n    if (page.url().includes('/admin')) {\n      console.log('✅ Đã ở admin page');\n    } else {\n      throw error;\n    }\n  }\n  \n  console.log('✅ Đăng nhập thành công');\n  \n  // Kiểm tra version plugin\n  console.log('🔍 Kiểm tra version plugin...');\n  await page.waitForTimeout(2000);\n  \n  const versionElement = await page.locator('div:has-text(\"Smart Filter v1.0.6\")').first();\n  if (await versionElement.isVisible()) {\n    console.log('✅ Plugin v1.0.6 đã load thành công');\n  } else {\n    console.log('⚠️ Không thấy version display, có thể cần refresh');\n  }\n  \n  // Kiểm tra tất cả ListingTypes và ItemField\n  console.log('🔍 Kiểm tra tất cả ListingTypes và ItemField...');\n  \n  const listingTypes = [\n    { id: 1, name: 'Scammer' },\n    { id: 7, name: 'Bank' },\n    { id: 20, name: 'Scammer' },\n    { id: 21, name: 'Bank' },\n    { id: 22, name: 'Seller' },\n    { id: 23, name: 'Seller' }\n  ];\n  \n  for (const listingType of listingTypes) {\n    console.log(`\\n🔍 Kiểm tra ${listingType.name} (ID: ${listingType.id})...`);\n    \n    const apiResponse = await page.request.get(`http://localhost:1337/api/smart-component-filter/listing-type/${listingType.id}/components`);\n    const apiData = await apiResponse.json();\n    \n    console.log(`📦 ${listingType.name} (ID: ${listingType.id}) API Response:`);\n    console.log(`   - Success: ${apiData.success}`);\n    console.log(`   - ListingType found: ${apiData.data?.listingType ? 'YES' : 'NO'}`);\n    console.log(`   - Components count: ${apiData.data?.allowedComponents?.length || 0}`);\n    \n    if (apiData.data?.allowedComponents?.length > 0) {\n      console.log(`   - Components: ${apiData.data.allowedComponents.join(', ')}`);\n    } else {\n      console.log(`   - ❌ NO COMPONENTS FOUND - ItemField likely NULL`);\n    }\n  }\n  \n  // Đi đến trang tạo item mới\n  console.log('\\n🔍 Đi đến trang tạo item mới...');\n  await page.goto('http://localhost:1337/admin/content-manager/collection-types/api::item.item/create?plugins%5Bi18n%5D%5Blocale%5D=en');\n  await page.waitForLoadState('networkidle');\n  \n  // Kiểm tra console logs\n  page.on('console', msg => {\n    if (msg.text().includes('Plugin Version') || msg.text().includes('Smart Component Filter')) {\n      console.log(`🎯 Console: ${msg.text()}`);\n    }\n  });\n  \n  // Test với Seller\n  console.log('\\n🔍 Test với Seller...');\n  \n  // Click vào ListingType dropdown\n  await page.click('[data-strapi-field-name=\"ListingType\"] button');\n  await page.waitForTimeout(1000);\n  \n  // Tìm và click Seller\n  const sellerOption = page.locator('text=Seller').first();\n  if (await sellerOption.isVisible()) {\n    console.log('✅ Tìm thấy Seller option');\n    await sellerOption.click();\n    await page.waitForTimeout(2000);\n    \n    console.log('✅ Đã chọn Seller');\n    \n    // Kiểm tra Dynamic Zone\n    console.log('🔍 Kiểm tra Dynamic Zone...');\n    \n    // Click vào Dynamic Zone để mở component picker\n    const dynamicZoneButton = page.locator('[data-strapi-field-name=\"FieldGroup\"] button').first();\n    if (await dynamicZoneButton.isVisible()) {\n      console.log('✅ Tìm thấy Dynamic Zone button');\n      await dynamicZoneButton.click();\n      await page.waitForTimeout(2000);\n      \n      // Kiểm tra components hiển thị\n      const componentButtons = await page.locator('div[role=\"dialog\"] button:not([aria-label])').all();\n      console.log(`🔍 Số components hiển thị: ${componentButtons.length}`);\n      \n      if (componentButtons.length > 0) {\n        console.log('📋 Components hiển thị:');\n        for (let i = 0; i < Math.min(componentButtons.length, 10); i++) {\n          const text = await componentButtons[i].textContent();\n          console.log(`   - ${text}`);\n        }\n        \n        // Kiểm tra xem có phải tất cả components hay đã được filter\n        if (componentButtons.length > 20) {\n          console.log('❌ HIỂN THỊ TẤT CẢ COMPONENTS - Plugin chưa hoạt động đúng');\n        } else {\n          console.log('✅ Components đã được filter - Plugin hoạt động đúng');\n        }\n      } else {\n        console.log('❌ Không có components nào hiển thị');\n      }\n      \n      // Đóng dialog\n      await page.keyboard.press('Escape');\n    } else {\n      console.log('❌ Không tìm thấy Dynamic Zone button');\n    }\n  } else {\n    console.log('❌ Không tìm thấy Seller option');\n  }\n  \n  console.log('\\n✅ Test hoàn thành!');\n}); 